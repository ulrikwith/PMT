# PMT Backend API Documentation

Complete reference for the PMT REST API.

**Base URL**: `http://localhost:3001`
**Version**: 1.0.0
**Last Updated**: 2026-01-21

---

## Overview

The PMT API provides endpoints for managing tasks, tags, relationships, and readiness calculations. All endpoints return JSON responses.

---

## Authentication

Currently no authentication required for local development. Production deployment should add authentication.

---

## Tasks

### List All Tasks

```http
GET /api/tasks
```

**Query Parameters**:
- `search` (optional): Search tasks by title or description
- `status` (optional): Filter by status
- `dimension` (optional): Filter by dimension tag

**Example**:
```bash
curl http://localhost:3001/api/tasks?status=In%20Progress
```

**Response**:
```json
{
  "success": true,
  "data": [
    {
      "id": "abc123",
      "title": "Book 4",
      "description": "Write book about PM",
      "status": "In Progress",
      "dueDate": "2026-02-28T09:00:00.000Z",
      "startDate": "2026-01-21T09:00:00.000Z",
      "tags": ["books", "content"],
      "workType": "part-of-element",
      "targetOutcome": "Complete the book",
      "activities": [
        {"title": "Chapter 1", "status": "done", "timeEstimate": "4"}
      ],
      "resources": {
        "timeEstimate": "20",
        "energyLevel": "Focused work"
      },
      "position": {"x": 200, "y": 150},
      "createdAt": "2026-01-20T10:00:00.000Z",
      "updatedAt": "2026-01-21T11:00:00.000Z"
    }
  ]
}
```

---

### Create Task

```http
POST /api/tasks
```

**Request Body**:
```json
{
  "title": "Book 4",
  "description": "Write book about project management",
  "tags": ["books", "content"],
  "status": "To do",
  "dueDate": "2026-02-28",
  "startDate": "2026-01-21",
  "workType": "part-of-element",
  "targetOutcome": "Complete the book",
  "activities": [
    {"title": "Chapter 1", "status": "todo", "timeEstimate": "4"}
  ],
  "resources": {
    "timeEstimate": "20",
    "energyLevel": "Focused work",
    "tools": ["Google Docs"],
    "materials": "Research notes"
  },
  "position": {"x": 200, "y": 150}
}
```

**Response**:
```json
{
  "success": true,
  "data": {
    "id": "abc123",
    "title": "Book 4",
    ...
    "createdAt": "2026-01-21T12:00:00.000Z",
    "updatedAt": "2026-01-21T12:00:00.000Z"
  }
}
```

---

### Update Task

```http
PUT /api/tasks/:id
```

**URL Parameters**:
- `id`: Task ID

**Request Body** (partial update supported):
```json
{
  "status": "In Progress",
  "activities": [
    {"title": "Chapter 1", "status": "done", "timeEstimate": "4"},
    {"title": "Chapter 2", "status": "in-progress", "timeEstimate": "6"}
  ]
}
```

**Response**:
```json
{
  "success": true,
  "data": {
    "id": "abc123",
    "status": "In Progress",
    ...
    "updatedAt": "2026-01-21T13:00:00.000Z"
  }
}
```

---

### Delete Task

```http
DELETE /api/tasks/:id
```

**URL Parameters**:
- `id`: Task ID

**Response**:
```json
{
  "success": true,
  "message": "Task deleted successfully"
}
```

---

## Tags

### List All Tags

```http
GET /api/tags
```

**Response**:
```json
{
  "success": true,
  "data": [
    {
      "name": "books",
      "color": "#6366F1",
      "dimension": "content"
    },
    {
      "name": "newsletter",
      "color": "#3B82F6",
      "dimension": "content"
    }
  ]
}
```

---

### Create Tag

```http
POST /api/tags
```

**Request Body**:
```json
{
  "name": "books",
  "color": "#6366F1"
}
```

**Response**:
```json
{
  "success": true,
  "data": {
    "id": "tag123",
    "name": "books",
    "color": "#6366F1"
  }
}
```

---

### Add Tag to Task

```http
POST /api/tasks/:taskId/tags
```

**URL Parameters**:
- `taskId`: Task ID

**Request Body**:
```json
{
  "tagName": "books"
}
```

**Response**:
```json
{
  "success": true,
  "message": "Tag added to task"
}
```

---

## Relationships

### Create Relationship

```http
POST /api/relationships
```

**Request Body**:
```json
{
  "fromTaskId": "task1",
  "toTaskId": "task2",
  "type": "generated-by"
}
```

**Relationship Types**:
- `generated-by`: Content task generated by Practice task
- `generates`: Practice task generates Content task
- `related-to`: General relationship

**Response**:
```json
{
  "success": true,
  "data": {
    "id": "rel123",
    "fromTaskId": "task1",
    "toTaskId": "task2",
    "type": "generated-by"
  }
}
```

---

### Get Task Relationships

```http
GET /api/tasks/:taskId/relationships
```

**URL Parameters**:
- `taskId`: Task ID

**Response**:
```json
{
  "success": true,
  "data": [
    {
      "id": "rel123",
      "fromTaskId": "task1",
      "toTaskId": "task2",
      "type": "generated-by",
      "relatedTask": {
        "id": "task2",
        "title": "Morning Walk Practice"
      }
    }
  ]
}
```

---

### Delete Relationship

```http
DELETE /api/relationships/:id
```

**URL Parameters**:
- `id`: Relationship ID

**Response**:
```json
{
  "success": true,
  "message": "Relationship deleted"
}
```

---

## Readiness

### Calculate Readiness

```http
GET /api/readiness
```

Calculates completion percentages for all dimensions based on task statuses.

**Response**:
```json
{
  "success": true,
  "data": {
    "content": {
      "label": "Content",
      "items": [
        {
          "name": "Substack Posts",
          "completed": true
        },
        {
          "name": "Newsletter",
          "completed": false
        },
        {
          "name": "Books",
          "completed": false
        }
      ]
    },
    "practice": {
      "label": "Practice",
      "items": [...]
    },
    "community": {...},
    "marketing": {...},
    "admin": {...}
  }
}
```

---

## Milestones

### Link Task to Milestone

```http
POST /api/tasks/:taskId/milestone
```

**Request Body**:
```json
{
  "milestoneId": "milestone123"
}
```

**Response**:
```json
{
  "success": true,
  "data": {
    "taskId": "task1",
    "milestoneId": "milestone123"
  }
}
```

---

### Get Milestone Progress

```http
GET /api/milestones/:milestoneId/progress
```

**Response**:
```json
{
  "success": true,
  "data": {
    "milestoneId": "milestone123",
    "totalTasks": 10,
    "completedTasks": 6,
    "completionPercentage": 60
  }
}
```

---

## Error Responses

### Error Format

```json
{
  "success": false,
  "error": "Error message",
  "code": "ERROR_CODE"
}
```

### Common Error Codes

| Code | Status | Description |
|------|--------|-------------|
| `TASK_NOT_FOUND` | 404 | Task ID does not exist |
| `INVALID_INPUT` | 400 | Request body validation failed |
| `SERVER_ERROR` | 500 | Internal server error |
| `BLUECC_SYNC_FAILED` | 502 | Blue.cc sync error |

---

## Data Models

### Task

```typescript
interface Task {
  id: string;
  title: string;
  description?: string;
  status: 'To do' | 'In Progress' | 'Done';
  dueDate?: string;  // ISO 8601
  startDate?: string;  // ISO 8601
  tags: string[];
  workType?: 'part-of-element' | 'delivery-enabler';
  targetOutcome?: string;
  activities: Activity[];
  resources: Resources;
  position?: Position;
  createdAt: string;  // ISO 8601
  updatedAt: string;  // ISO 8601
}
```

### Activity

```typescript
interface Activity {
  id?: number;
  title: string;
  status: 'todo' | 'in-progress' | 'done';
  timeEstimate?: string;
}
```

### Resources

```typescript
interface Resources {
  timeEstimate?: string;
  energyLevel?: 'Light work' | 'Focused work' | 'Deep work';
  tools?: string[];
  materials?: string;
  people?: string[];
}
```

### Position

```typescript
interface Position {
  x: number;
  y: number;
}
```

---

## Rate Limiting

Currently no rate limiting implemented. Consider adding for production:
- 100 requests per minute per IP
- 1000 requests per hour per IP

---

## Changelog

### v1.0.0 (2026-01-21)
- Initial API release
- Tasks CRUD operations
- Tags management
- Relationships
- Readiness calculation
- Blue.cc cloud sync

---

## Examples

### Complete Workflow Example

```bash
# 1. Create a task
TASK_ID=$(curl -X POST http://localhost:3001/api/tasks \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Write Newsletter",
    "tags": ["newsletter", "content"],
    "status": "To do",
    "dueDate": "2026-01-28"
  }' | jq -r '.data.id')

# 2. Update task status
curl -X PUT http://localhost:3001/api/tasks/$TASK_ID \
  -H "Content-Type: application/json" \
  -d '{"status": "In Progress"}'

# 3. Add activity
curl -X PUT http://localhost:3001/api/tasks/$TASK_ID \
  -H "Content-Type: application/json" \
  -d '{
    "activities": [
      {"title": "Draft outline", "status": "done", "timeEstimate": "1"},
      {"title": "Write content", "status": "in-progress", "timeEstimate": "3"}
    ]
  }'

# 4. Complete task
curl -X PUT http://localhost:3001/api/tasks/$TASK_ID \
  -H "Content-Type: application/json" \
  -d '{"status": "Done"}'

# 5. Check readiness
curl http://localhost:3001/api/readiness | jq '.data.content'
```

---

## Support

For API issues or questions:
- **Email**: ulrikwith@gmail.com
- **GitHub**: https://github.com/ulrikwith/PMT/issues

---

**Version**: 1.0.0
**Last Updated**: 2026-01-21
